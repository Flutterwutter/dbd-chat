<html>
    <head>
        <title>D&D Chat</title>
        <style>
            body{font-family:sans-serif; background:#111; color:white; display:flex; flex-direction:column; height:100vh; }
            #chat { flex:1; overflow-y:auto; border:1px solid #333; padding:10px; }
            #input { display:flex; gap:10px; }
            input { flex:1; padding:8px; border:none; border-radius:6px; }
            button {padding:8px 12px; border:none; border-radius:6px; background:#4a4aff; color:white; cursor:pointer; }
        </style>
    </head>
    <body>
        <h2> 🧙‍♂ D&D Group Chat </h2>
        <div id="chat"></div>
        <div id="input">
            <input id="msg" placeholder="Type a message..." />
            <button>Send</button>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const password = prompt("Enter chat password:");
            if (!password) {
                alert("Password required!");
                throw new Error("No password entered");
            }

            const socket = io({ auth: { password } });

            socket.on("connect_error", (err) => {
                if (err.message === "invalid password") {
                    alert("❌ Wrong password! Access denied.");
                    window.location.reload();
                }
            });

            const name = prompt("Enter your name:") || "Adventurer";
            const chat = document.getElementById("chat");
            const msg = document.getElementById("msg");
            const btn = document.querySelector("button");

            function add(text) {
                const div = document.createElement("div");
                div.textContent = text;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }

            function sendMessage() {
                const text = msg.value.trim();
                if (!text) return;
                socket.emit("chat", `${name}: ${text}`);
                msg.value = "";
            }

            socket.on("chat", add);

            btn.onclick = sendMessage;

            msg.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    sendMessage();
                }
            });
        </script>
    </body>
</html>